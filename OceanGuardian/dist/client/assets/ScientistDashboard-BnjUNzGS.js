import{u as A,j as e,g as l,C as x,c as m,B as N}from"./index-B2j6MuZ4.js";import{r as a}from"./vendor-DvMla3zT.js";import{S as b,a as y,b as w,c as S,d as r}from"./select-C6dmHz15.js";import{E as L,a4 as V,D as _,a5 as B,a6 as J,V as C,l as O,X as P}from"./ui-CRTwZCWL.js";import"./maps-DK6RsE9k.js";import"./index-BdQq_4o_.js";import"./index-DuD6u1I3.js";function Q(){const{profile:c,loading:h}=A(),[i,u]=a.useState([]),[k,p]=a.useState(!0),[j,f]=a.useState(""),[n,D]=a.useState("csv"),[g,E]=a.useState("30");a.useEffect(()=>{!h&&c?.role!=="scientist"&&c?.role!=="admin"&&f("Access Denied: Scientist/Admin only.")},[c,h]);const d=async()=>{p(!0);try{const s=await fetch("/api/coral/review-queue");if(s.status===403)throw new Error("Access Denied: Scientist/Admin only.");if(!s.ok)throw new Error("Failed to fetch queue");const t=await s.json();u(t)}catch(s){f(s.message)}finally{p(!1)}};a.useEffect(()=>{d()},[]);const v=async(s,t)=>{u(o=>o.filter(R=>R.id!==s));try{await fetch(`/api/coral/review/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:t})})}catch(o){console.error(o),alert("Failed to update status"),d()}},F=()=>{const s=`/api/scientist/export?format=${n}&days=${g}`;window.open(s,"_blank")};return k?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):j?e.jsx("div",{className:"container p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto bg-destructive/10 text-destructive p-6 rounded-lg flex flex-col items-center gap-4",children:[e.jsx(V,{className:"h-12 w-12"}),e.jsx("h2",{className:"text-xl font-bold",children:"Access Denied"}),e.jsx("p",{children:j})]})}):e.jsxs("div",{className:"container mx-auto p-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Scientist Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage data quality and export research data."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(l,{onClick:d,variant:"outline",size:"sm",children:"Refresh Queue"})})]}),e.jsx(x,{className:"bg-primary/5 border-primary/20",children:e.jsxs(m,{className:"p-4 flex flex-col md:flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"})," Data Export"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Download verified sightings data for analysis."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{value:g,onValueChange:E,children:[e.jsx(y,{className:"w-[120px] bg-background",children:e.jsx(w,{placeholder:"Period"})}),e.jsxs(S,{children:[e.jsx(r,{value:"7",children:"Last 7 Days"}),e.jsx(r,{value:"30",children:"Last 30 Days"}),e.jsx(r,{value:"90",children:"Last 90 Days"}),e.jsx(r,{value:"365",children:"Last Year"})]})]}),e.jsxs(b,{value:n,onValueChange:D,children:[e.jsx(y,{className:"w-[120px] bg-background",children:e.jsx(w,{placeholder:"Format"})}),e.jsxs(S,{children:[e.jsx(r,{value:"csv",children:"CSV"}),e.jsx(r,{value:"geojson",children:"GeoJSON"})]})]}),e.jsxs(l,{onClick:F,children:[n==="csv"?e.jsx(B,{className:"mr-2 h-4 w-4"}):e.jsx(J,{className:"mr-2 h-4 w-4"}),"Export"]})]})]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-green-500"})," Review Queue (",i.length,")"]}),i.length===0?e.jsx(x,{className:"bg-muted/50 border-dashed",children:e.jsx(m,{className:"py-12 text-center text-muted-foreground",children:"No pending reviews. Good job! ðŸª¸"})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(s=>e.jsxs(x,{className:"overflow-hidden flex flex-col",children:[s.image_key?e.jsxs("div",{className:"aspect-video bg-muted relative",children:[e.jsx("img",{src:`/api/sightings/${s.id}/photo`,alt:"Coral",className:"w-full h-full object-cover",onError:t=>t.currentTarget.style.display="none"}),e.jsxs(N,{className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70",children:[s.bleach_percent,"% Bleached"]})]}):e.jsx("div",{className:"aspect-video bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-muted-foreground",children:"No Image"})}),e.jsxs(m,{className:"flex-1 p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold truncate",children:s.subcategory||"Coral Report"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",s.user_name]})]}),e.jsxs(N,{variant:s.severity>3?"destructive":"secondary",children:["Sev: ",s.severity]})]}),e.jsxs("p",{className:"text-sm line-clamp-2 text-muted-foreground bg-muted p-2 rounded",children:['"',s.description,'"']}),e.jsxs("div",{className:"text-xs text-muted-foreground flex gap-2",children:[e.jsx(O,{className:"h-3 w-3"}),s.latitude.toFixed(4),", ",s.longitude.toFixed(4)]}),s.ai_analysis&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded border border-blue-100 dark:border-blue-900 text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700 dark:text-blue-300",children:"AI Says:"}),e.jsx("p",{className:"line-clamp-2",children:JSON.parse(s.ai_analysis).recommendation})]})]}),e.jsxs("div",{className:"p-4 pt-0 mt-auto flex gap-2",children:[e.jsxs(l,{className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",onClick:()=>v(s.id,"approve"),children:[e.jsx(C,{className:"h-4 w-4 mr-1"})," Verify"]}),e.jsxs(l,{variant:"destructive",className:"flex-1",size:"sm",onClick:()=>v(s.id,"reject"),children:[e.jsx(P,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})]})]})}export{Q as default};
