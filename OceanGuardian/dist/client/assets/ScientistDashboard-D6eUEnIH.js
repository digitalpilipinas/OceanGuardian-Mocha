import{u as R,j as e,B as l,d as x,C as m,c as N}from"./index-w4qC22aZ.js";import{r as a}from"./vendor-tuWJg29S.js";import{S as b,a as y,b as w,c as S,d as t}from"./select-BjY4izMW.js";import{N as L,aa as q,a4 as V,D as _,ab as P,ac as T,$ as k,r as $,o as B,X as J}from"./ui-DmkW-1mw.js";import"./maps-D8oPmz78.js";import"./index-BdQq_4o_.js";import"./index-C8E_68Py.js";function U(){const{profile:n,loading:h}=R(),[i,u]=a.useState([]),[C,p]=a.useState(!0),[f,j]=a.useState(""),[c,D]=a.useState("csv"),[g,E]=a.useState("30");a.useEffect(()=>{!h&&n?.role!=="scientist"&&n?.role!=="admin"&&j("Access Denied: Scientist/Admin only.")},[n,h]);const o=async()=>{p(!0);try{const s=await fetch("/api/coral/review-queue");if(s.status===403)throw new Error("Access Denied: Scientist/Admin only.");if(!s.ok)throw new Error("Failed to fetch queue");const r=await s.json();u(r)}catch(s){j(s.message)}finally{p(!1)}};a.useEffect(()=>{o()},[]);const v=async(s,r)=>{u(d=>d.filter(A=>A.id!==s));try{await fetch(`/api/coral/review/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:r})})}catch(d){console.error(d),alert("Failed to update status"),o()}},F=()=>{const s=`/api/scientist/export?format=${c}&days=${g}`;window.open(s,"_blank")};return C?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):f?e.jsx("div",{className:"container p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto bg-destructive/10 text-destructive p-6 rounded-lg flex flex-col items-center gap-4",children:[e.jsx(q,{className:"h-12 w-12"}),e.jsx("h2",{className:"text-xl font-bold",children:"Access Denied"}),e.jsx("p",{children:f})]})}):e.jsxs("div",{className:"container mx-auto py-4 space-y-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl md:text-5xl font-black text-foreground tracking-tight",children:["Scientist ",e.jsx("span",{className:"text-primary",children:"Station"})]}),e.jsx("p",{className:"text-muted-foreground text-lg font-medium mt-2",children:"Manage data quality and export research data for conservation."})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(l,{onClick:o,variant:"neomorph",className:"h-12 px-6 font-bold",children:[e.jsx(V,{className:"mr-2 h-5 w-5 text-primary"})," Refresh Queue"]})})]}),e.jsxs(x,{variant:"solid",className:"relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"}),e.jsxs(m,{className:"p-8 relative z-10 flex flex-col lg:flex-row items-center gap-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-3 text-foreground mb-1",children:[e.jsx("div",{className:"p-2 rounded-xl neo-flat",children:e.jsx(_,{className:"h-5 w-5 text-primary"})}),"Research Data Export"]}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Download verified sightings data for in-depth analysis and reporting."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 w-full lg:w-auto",children:[e.jsxs(b,{value:g,onValueChange:E,children:[e.jsx(y,{className:"w-[160px] h-12 neo-interactive bg-background/50 border-none rounded-xl font-bold",children:e.jsx(w,{placeholder:"Period"})}),e.jsxs(S,{className:"glass-liquid border-white/10",children:[e.jsx(t,{value:"7",children:"Last 7 Days"}),e.jsx(t,{value:"30",children:"Last 30 Days"}),e.jsx(t,{value:"90",children:"Last 90 Days"}),e.jsx(t,{value:"365",children:"Last Year"})]})]}),e.jsxs(b,{value:c,onValueChange:D,children:[e.jsx(y,{className:"w-[140px] h-12 neo-interactive bg-background/50 border-none rounded-xl font-bold",children:e.jsx(w,{placeholder:"Format"})}),e.jsxs(S,{className:"glass-liquid border-white/10",children:[e.jsx(t,{value:"csv",children:"CSV File"}),e.jsx(t,{value:"geojson",children:"GeoJSON"})]})]}),e.jsxs(l,{variant:"neomorph-primary",className:"h-12 px-8 font-bold text-sm uppercase tracking-widest",onClick:F,children:[c==="csv"?e.jsx(P,{className:"mr-2 h-5 w-5"}):e.jsx(T,{className:"mr-2 h-5 w-5"}),"Export Data"]})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h2",{className:"text-2xl font-black flex items-center gap-4 text-foreground",children:[e.jsx("div",{className:"p-2 rounded-xl neo-flat",children:e.jsx(k,{className:"h-6 w-6 text-primary"})}),"Verification Queue ",e.jsxs("span",{className:"text-muted-foreground font-medium ml-2 text-lg",children:["(",i.length," Pending)"]})]}),i.length===0?e.jsx(x,{variant:"neomorph",className:"border-dashed border-2 border-primary/20 bg-background/50",children:e.jsxs(m,{className:"py-20 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6 neo-flat",children:e.jsx($,{className:"h-8 w-8 text-primary"})}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:"All Clear!"}),e.jsx("p",{className:"text-muted-foreground mt-2 font-medium",children:"The verification queue is currently empty. Excellent work, Doctor."})]})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(s=>e.jsxs(x,{className:"overflow-hidden flex flex-col",children:[s.image_key?e.jsxs("div",{className:"aspect-video bg-muted relative",children:[e.jsx("img",{src:`/api/sightings/${s.id}/photo`,alt:"Coral",className:"w-full h-full object-cover",onError:r=>r.currentTarget.style.display="none"}),e.jsxs(N,{className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70",children:[s.bleach_percent,"% Bleached"]})]}):e.jsx("div",{className:"aspect-video bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-muted-foreground",children:"No Image"})}),e.jsxs(m,{className:"flex-1 p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold truncate",children:s.subcategory||"Coral Report"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",s.user_name]})]}),e.jsxs(N,{variant:s.severity>3?"destructive":"secondary",children:["Sev: ",s.severity]})]}),e.jsxs("p",{className:"text-sm line-clamp-2 text-muted-foreground bg-muted p-2 rounded",children:['"',s.description,'"']}),e.jsxs("div",{className:"text-xs text-muted-foreground flex gap-2",children:[e.jsx(B,{className:"h-3 w-3"}),s.latitude.toFixed(4),", ",s.longitude.toFixed(4)]}),s.ai_analysis&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded border border-blue-100 dark:border-blue-900 text-xs",children:[e.jsx("span",{className:"font-semibold text-blue-700 dark:text-blue-300",children:"AI Says:"}),e.jsx("p",{className:"line-clamp-2",children:JSON.parse(s.ai_analysis).recommendation})]})]}),e.jsxs("div",{className:"p-4 pt-0 mt-auto flex gap-2",children:[e.jsxs(l,{className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",onClick:()=>v(s.id,"approve"),children:[e.jsx(k,{className:"h-4 w-4 mr-1"})," Verify"]}),e.jsxs(l,{variant:"destructive",className:"flex-1",size:"sm",onClick:()=>v(s.id,"reject"),children:[e.jsx(J,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})]})]})}export{U as default};
