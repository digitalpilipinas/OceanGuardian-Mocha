import{j as e,C as y,c as k,B as C,g as w,u as R,A as V,d as W,e as H}from"./index-BSERnFbJ.js";import{M as P,T as U,i as q,b as G,l as A,u as J}from"./maps-DK6RsE9k.js";/* empty css                */import{r as i,L as N}from"./vendor-DvMla3zT.js";import{p as z,X as _,q as D,r as F,s as B,W as L,u as Z,v as X,T as Y,w as K,x as Q,y as ee,d as te,C as se,l as ae,M as le,z as re,E as ne,P as ie}from"./ui-CRTwZCWL.js";import{I as oe}from"./input-COp-znCL.js";const ce=[{type:"garbage",icon:D,label:"Garbage",color:"bg-red-500",emoji:"ğŸ—‘ï¸"},{type:"floating",icon:F,label:"Floating",color:"bg-orange-500",emoji:"ğŸš¢"},{type:"wildlife",icon:B,label:"Wildlife",color:"bg-green-500",emoji:"ğŸ¢"},{type:"coral",icon:L,label:"Coral",color:"bg-pink-500",emoji:"ğŸª¸"}],de=[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"}],me=[{value:1,label:"Any",emoji:"ğŸŸ¢"},{value:2,label:"2+",emoji:"ğŸŸ¡"},{value:3,label:"3+",emoji:"ğŸŸ "},{value:4,label:"4+",emoji:"ğŸ”´"},{value:5,label:"5",emoji:"ğŸš¨"}];function xe({selectedTypes:t,onFilterChange:r,totalSightings:l,dateRange:n,onDateRangeChange:o,minSeverity:c,onMinSeverityChange:x}){const[g,j]=i.useState(!1),p=s=>{t.includes(s)?t.length>1&&r(t.filter(f=>f!==s)):r([...t,s])},d=()=>{r(["garbage","floating","wildlife","coral"])},h=t.length,u=h===4,b=!u||n!=="all"||c>1;return e.jsx(y,{className:"shadow-lg backdrop-blur-sm bg-card/95",children:e.jsxs(k,{className:"p-3",children:[!g&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:u?"All Types":`${h} Type${h!==1?"s":""}`}),e.jsx(C,{variant:"secondary",className:"text-xs",children:l}),b&&e.jsx("span",{className:"h-2 w-2 rounded-full bg-primary animate-pulse"})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>j(!0),className:"h-8 px-2",children:e.jsx(z,{className:"h-4 w-4"})})]}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-semibold",children:"Filters"}),e.jsxs(C,{variant:"secondary",className:"text-xs",children:[l," results"]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>j(!1),className:"h-6 w-6 p-0",children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Type"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ce.map(s=>{const f=t.includes(s.type);return e.jsxs("button",{onClick:()=>p(s.type),className:`
                        flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all
                        ${f?"bg-primary text-primary-foreground shadow-sm":"bg-muted/50 text-muted-foreground hover:bg-muted"}
                      `,children:[e.jsx("span",{className:"text-sm",children:s.emoji}),e.jsx("span",{className:"text-xs",children:s.label})]},s.type)})}),!u&&e.jsx("button",{onClick:d,className:"text-xs text-primary hover:underline w-full text-center pt-1",children:"Select All"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"})," Time Range"]}),e.jsx("div",{className:"flex gap-1.5",children:de.map(s=>e.jsx("button",{onClick:()=>o(s.value),className:`
                      flex-1 px-2 py-1.5 rounded-md text-xs font-medium transition-all
                      ${n===s.value?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground hover:bg-muted"}
                    `,children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"})," Min Severity"]}),e.jsx("div",{className:"flex gap-1.5",children:me.map(s=>e.jsxs("button",{onClick:()=>x(s.value),className:`
                      flex-1 flex flex-col items-center gap-0.5 px-2 py-1.5 rounded-md transition-all
                      ${c===s.value?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground hover:bg-muted"}
                    `,children:[e.jsx("span",{className:"text-sm",children:s.emoji}),e.jsx("span",{className:"text-[10px] font-medium",children:s.label})]},s.value))})]})]})]})})}const M={garbage:{icon:D,label:"Beach Garbage",color:"text-red-500",bg:"bg-red-100 dark:bg-red-900/30",emoji:"ğŸ—‘ï¸"},floating:{icon:F,label:"Floating Trash",color:"text-orange-500",bg:"bg-orange-100 dark:bg-orange-900/30",emoji:"ğŸš¢"},wildlife:{icon:B,label:"Wildlife",color:"text-green-500",bg:"bg-green-100 dark:bg-green-900/30",emoji:"ğŸ¢"},coral:{icon:L,label:"Coral Health",color:"text-pink-500",bg:"bg-pink-100 dark:bg-pink-900/30",emoji:"ğŸª¸"}},$={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",approved:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",flagged:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},ue=["","ğŸŸ¢","ğŸŸ¡","ğŸŸ ","ğŸ”´","ğŸš¨"];function he(t){return new Date(t).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function T(t){const r=new Date(t),n=new Date().getTime()-r.getTime(),o=Math.floor(n/(1e3*60)),c=Math.floor(n/(1e3*60*60)),x=Math.floor(n/(1e3*60*60*24));return o<1?"Just now":o<60?`${o}m ago`:c<24?`${c}h ago`:x===1?"Yesterday":`${x}d ago`}function pe({sighting:t,onClose:r}){const{profile:l}=R(),n=M[t.type]||M.garbage,[o,c]=i.useState([]),[x,g]=i.useState(""),[j,p]=i.useState(t.validation_count),[d,h]=i.useState(!1),[u,b]=i.useState(!1),[s,f]=i.useState(!1);i.useEffect(()=>{t.id&&(v(),S())},[t.id,l]);const v=async()=>{b(!0);try{const a=await fetch(`/api/sightings/${t.id}/comments`);a.ok&&c(await a.json())}catch(a){console.error("Failed to fetch comments",a)}finally{b(!1)}},S=async()=>{if(l)try{const a=await fetch(`/api/sightings/${t.id}/validate`);if(a.ok){const m=await a.json();h(m.validated)}}catch(a){console.error("Failed to check validation",a)}},E=async()=>{if(l){h(!d),p(a=>d?a-1:a+1);try{const a=await fetch(`/api/sightings/${t.id}/validate`,{method:"POST"});if(!a.ok)h(!d),p(m=>d?m+1:m-1);else{const m=await a.json();p(m.validation_count)}}catch{h(!d),p(m=>d?m+1:m-1)}}},I=async a=>{if(a.preventDefault(),!(!x.trim()||!l)){f(!0);try{const m=await fetch(`/api/sightings/${t.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:x})});if(m.ok){const O=await m.json();c([...o,O]),g("")}}catch(m){console.error("Failed to post comment",m)}finally{f(!1)}}};return e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-[1100] animate-in slide-in-from-bottom duration-300",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm -z-10",onClick:r}),e.jsxs(y,{className:"rounded-t-2xl rounded-b-none shadow-2xl max-h-[70vh] overflow-y-auto mx-auto max-w-lg",children:[e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),e.jsxs(k,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${n.bg}`,children:e.jsx("span",{className:"text-xl",children:n.emoji})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.subcategory}),e.jsx("p",{className:`text-sm font-medium ${n.color}`,children:n.label})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:r,className:"h-8 w-8 p-0 shrink-0",children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:$[t.status]||$.pending,children:t.status||"pending"}),e.jsxs(C,{variant:"outline",className:"text-sm",children:[ue[t.severity]||"ğŸŸ¢"," Severity ",t.severity,"/5"]})]}),e.jsxs(w,{variant:d?"default":"outline",size:"sm",className:`gap-1.5 h-8 ${d?"bg-blue-600 hover:bg-blue-700":""}`,onClick:E,disabled:!l,children:[e.jsx(Y,{className:`h-3.5 w-3.5 ${d?"fill-current":""}`}),e.jsx("span",{children:j}),e.jsx("span",{className:"sr-only",children:"Validations"})]})]}),t.image_key&&e.jsx("div",{className:"rounded-xl overflow-hidden border",children:e.jsx("img",{src:`/api/sightings/${t.id}/photo`,alt:"Sighting photo",className:"w-full h-48 object-cover",loading:"lazy"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm leading-relaxed",children:t.description})}),t.type==="coral"&&(t.water_temp||t.bleach_percent||t.depth)&&e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.water_temp&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 text-center",children:[e.jsx(K,{className:"h-4 w-4 mx-auto text-orange-500 mb-1"}),e.jsxs("p",{className:"text-sm font-bold",children:[t.water_temp,"Â°C"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Water Temp"})]}),t.bleach_percent!=null&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 text-center",children:[e.jsx(Q,{className:"h-4 w-4 mx-auto text-blue-500 mb-1"}),e.jsxs("p",{className:"text-sm font-bold",children:[t.bleach_percent,"%"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Bleaching"})]}),t.depth&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2.5 text-center",children:[e.jsx(ee,{className:"h-4 w-4 mx-auto text-cyan-500 mb-1"}),e.jsxs("p",{className:"text-sm font-bold",children:[t.depth,"m"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Depth"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground border-t pt-3",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[t.user_name||"Anonymous",t.user_level?` Â· Lvl ${t.user_level}`:""]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5",title:he(t.created_at),children:[e.jsx(se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:T(t.created_at)})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(ae,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{children:t.address||`${t.latitude.toFixed(4)}, ${t.longitude.toFixed(4)}`})]}),e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Comments (",o.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto pr-1",children:u?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"Loading comments..."}):o.length===0?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"No comments yet. Be the first!"}):o.map(a=>e.jsxs("div",{className:"flex gap-2.5 text-sm",children:[e.jsx(N,{to:`/profile/${a.user_id}`,children:e.jsxs(V,{className:"h-6 w-6 border",children:[e.jsx(W,{src:a.avatar_url||void 0}),e.jsx(H,{className:"text-[10px]",children:a.username?.[0]?.toUpperCase()||"?"})]})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{to:`/profile/${a.user_id}`,className:"font-medium hover:underline text-xs",children:a.username||"Anonymous"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:T(a.created_at)})]}),e.jsx("p",{className:"text-muted-foreground leading-snug",children:a.content})]})]},a.id))}),l?e.jsxs("form",{onSubmit:I,className:"flex gap-2",children:[e.jsx(oe,{placeholder:"Add a comment...",value:x,onChange:a=>g(a.target.value),className:"h-8 text-sm",disabled:s}),e.jsx(w,{size:"sm",type:"submit",disabled:!x.trim()||s,className:"h-8 w-8 p-0 shrink-0",children:e.jsx(re,{className:"h-3.5 w-3.5"})})]}):e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2 text-center text-xs",children:[e.jsx(N,{to:"/login",className:"text-primary hover:underline",children:"Log in"})," to comment"]})]})]})]})]})}const fe={garbage:`<svg xmlns='http://www.w3.org/2000/svg' width='32' height='40' viewBox='0 0 32 40'>
    <path d='M16 0C7.16 0 0 7.16 0 16c0 12 16 24 16 24s16-12 16-24C32 7.16 24.84 0 16 0z' fill='%23ef4444'/>
    <circle cx='16' cy='15' r='8' fill='white' opacity='0.3'/>
    <text x='16' y='19' text-anchor='middle' font-size='12'>ğŸ—‘ï¸</text>
  </svg>`,floating:`<svg xmlns='http://www.w3.org/2000/svg' width='32' height='40' viewBox='0 0 32 40'>
    <path d='M16 0C7.16 0 0 7.16 0 16c0 12 16 24 16 24s16-12 16-24C32 7.16 24.84 0 16 0z' fill='%23f97316'/>
    <circle cx='16' cy='15' r='8' fill='white' opacity='0.3'/>
    <text x='16' y='19' text-anchor='middle' font-size='12'>ğŸš¢</text>
  </svg>`,wildlife:`<svg xmlns='http://www.w3.org/2000/svg' width='32' height='40' viewBox='0 0 32 40'>
    <path d='M16 0C7.16 0 0 7.16 0 16c0 12 16 24 16 24s16-12 16-24C32 7.16 24.84 0 16 0z' fill='%2322c55e'/>
    <circle cx='16' cy='15' r='8' fill='white' opacity='0.3'/>
    <text x='16' y='19' text-anchor='middle' font-size='12'>ğŸ¢</text>
  </svg>`,coral:`<svg xmlns='http://www.w3.org/2000/svg' width='32' height='40' viewBox='0 0 32 40'>
    <path d='M16 0C7.16 0 0 7.16 0 16c0 12 16 24 16 24s16-12 16-24C32 7.16 24.84 0 16 0z' fill='%23ec4899'/>
    <circle cx='16' cy='15' r='8' fill='white' opacity='0.3'/>
    <text x='16' y='19' text-anchor='middle' font-size='12'>ğŸª¸</text>
  </svg>`};function ge(t){return new A.DivIcon({html:fe[t],className:"custom-marker-icon",iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-40]})}function je(t){const r=t.getChildCount();let l="small",n="bg-primary";return r>=100?(l="large",n="bg-red-500"):r>=10&&(l="medium",n="bg-orange-500"),new A.DivIcon({html:`<div class="cluster-marker ${n} ${l}">
      <span>${r}</span>
    </div>`,className:"custom-cluster-icon",iconSize:[40,40],iconAnchor:[20,20]})}function be({sightings:t}){const r=J();return i.useEffect(()=>{if(t.length>0){const l=t.map(n=>[n.latitude,n.longitude]);r.fitBounds(l,{padding:[50,50],maxZoom:13})}},[t,r]),null}function ve(t,r){if(r==="all")return!0;const l=new Date(t),c=(new Date().getTime()-l.getTime())/(1e3*60*60*24);switch(r){case"today":return c<1;case"week":return c<7;case"month":return c<30;default:return!0}}function ze(){const[t,r]=i.useState([]),[l,n]=i.useState(["garbage","floating","wildlife","coral"]),[o,c]=i.useState("all"),[x,g]=i.useState(1),[j,p]=i.useState(!0),[d,h]=i.useState(null);i.useEffect(()=>{const s=async()=>{try{const v=await fetch("/api/sightings");if(v.ok){const S=await v.json();r(S)}}catch(v){console.error("Failed to load sightings:",v)}finally{p(!1)}};s();const f=setInterval(s,3e4);return()=>clearInterval(f)},[]);const u=i.useMemo(()=>t.filter(s=>l.includes(s.type)&&s.severity>=x&&ve(s.created_at,o)),[t,l,x,o]),b=[14.5547,121.024];return e.jsxs("div",{className:"relative h-[calc(100vh-4rem)] md:h-[calc(100vh-4rem)]",children:[e.jsx("style",{children:`
        .custom-marker-icon { background: none; border: none; }
        .custom-cluster-icon { background: none; border: none; }
        .cluster-marker {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          color: white;
          font-weight: bold;
          font-size: 14px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3);
          border: 3px solid rgba(255,255,255,0.8);
        }
        .cluster-marker.medium { width: 48px; height: 48px; font-size: 15px; }
        .cluster-marker.large { width: 56px; height: 56px; font-size: 16px; }
        .bg-primary { background: hsl(var(--primary)); }
        .bg-orange-500 { background: #f97316; }
        .bg-red-500 { background: #ef4444; }
      `}),e.jsx("div",{className:"absolute top-4 left-4 right-4 md:left-4 md:right-auto md:w-80 z-[1000]",children:e.jsx(xe,{selectedTypes:l,onFilterChange:n,totalSightings:u.length,dateRange:o,onDateRangeChange:c,minSeverity:x,onMinSeverityChange:g})}),j&&e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[1000]",children:e.jsx(y,{className:"shadow-lg",children:e.jsxs(k,{className:"p-4 flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 animate-spin text-primary"}),e.jsx("span",{className:"text-sm",children:"Loading sightings..."})]})})}),e.jsxs(P,{center:b,zoom:13,className:"h-full w-full",style:{background:"#e0f2fe"},children:[e.jsx(U,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(q,{chunkedLoading:!0,maxClusterRadius:60,iconCreateFunction:je,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,children:u.map(s=>e.jsx(G,{position:[s.latitude,s.longitude],icon:ge(s.type),eventHandlers:{click:()=>h(s)}},s.id))}),u.length>0&&e.jsx(be,{sightings:u})]}),e.jsx("div",{className:"absolute bottom-20 md:bottom-4 right-4 z-[1000]",children:e.jsx(y,{className:"shadow-lg backdrop-blur-sm bg-card/90",children:e.jsx(k,{className:"p-3",children:e.jsxs("div",{className:"text-sm font-medium",children:[u.length," sighting",u.length!==1?"s":""]})})})}),e.jsx("div",{className:"absolute bottom-24 md:bottom-16 right-4 z-[1000]",children:e.jsx(w,{asChild:!0,size:"lg",className:"h-14 w-14 rounded-full shadow-lg",children:e.jsx(N,{to:"/report",children:e.jsx(ie,{className:"h-6 w-6"})})})}),d&&e.jsx(pe,{sighting:d,onClose:()=>h(null)})]})}export{ze as default};
