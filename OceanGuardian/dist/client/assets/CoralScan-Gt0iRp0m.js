import{j as e,C as y,a as j,b as v,f as b,c as N,g as i}from"./index-BVp5WuMy.js";import{e as w,r as l}from"./vendor-DvMla3zT.js";import{J as C,K as S,E as A,I as z}from"./ui-CRTwZCWL.js";import"./maps-DK6RsE9k.js";function E(){const x=w(),[o,c]=l.useState(null),[d,m]=l.useState(null),[h,u]=l.useState(!1),[a,n]=l.useState(null),p=s=>{if(s.target.files?.[0]){const t=s.target.files[0];c(t),m(URL.createObjectURL(t)),n(null)}},f=async()=>{if(o){u(!0);try{const s=new FormData;s.append("image",o);const t=await fetch("/api/coral/analyze",{method:"POST",body:s});if(!t.ok)throw new Error("Analysis failed");const r=await t.json();n(r)}catch(s){console.error(s),alert("Failed to analyze image. Please try again.")}finally{u(!1)}}},g=async()=>{if(!navigator.geolocation){alert("Geolocation needed to save report.");return}navigator.geolocation.getCurrentPosition(async s=>{try{const t={type:"coral",subcategory:"Analyzed Scan",description:`AI Analysis: ${a.severity} (${a.bleachPercent}% bleaching). ${a.recommendation}`,severity:a.severity==="Healthy"?1:a.severity==="Low"?2:a.severity==="Moderate"?3:a.severity==="High"?4:5,latitude:s.coords.latitude,longitude:s.coords.longitude,bleach_percent:a.bleachPercent,ai_analysis:JSON.stringify(a)},r=await fetch("/api/sightings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to save report");await r.json(),alert("Report saved successfully!"),x("/map")}catch(t){console.error(t),alert("Error saving report.")}})};return e.jsx("div",{className:"container max-w-lg mx-auto p-4 py-8",children:e.jsxs(y,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6 text-primary"}),"Coral Health Scan"]}),e.jsx(b,{children:"Upload a photo of coral to detect bleaching severity using our AI model."})]}),e.jsxs(N,{className:"space-y-6",children:[!a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"block w-full aspect-square md:aspect-video rounded-xl border-2 border-dashed border-muted-foreground/25 hover:border-primary/50 transition-colors cursor-pointer flex flex-col items-center justify-center gap-2 bg-muted/10 relative overflow-hidden",children:[d?e.jsx("img",{src:d,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-10 h-10 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tap to take photo or upload"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:p,className:"hidden"})]}),e.jsx(i,{onClick:f,disabled:!o||h,className:"w-full",size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Analyzing Coral Structure..."]}):"Analyze Health"})]}),a&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full border-4 text-3xl font-bold bg-background shadow-lg",style:{borderColor:a.color,color:a.color},children:[a.bleachPercent,"%"]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",style:{color:a.color},children:[a.severity," Bleaching"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Confidence: ",(a.confidence*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg space-y-2 border-l-4",style:{borderColor:a.color},children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"})," Recommendation"]}),e.jsx("p",{className:"text-sm",children:a.recommendation})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{variant:"outline",className:"flex-1",onClick:()=>{c(null),m(null),n(null)},children:"Scan Another"}),e.jsx(i,{className:"flex-1",onClick:g,children:"Save Report"})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground pt-4",children:"* AI analysis is experimental. Submit report for scientist validation."})]})]})]})})}export{E as default};
