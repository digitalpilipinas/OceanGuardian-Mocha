import{S as O,j as e,g as M,C as c,a as d,b as o,c as x,f as T,B as $}from"./index-CLnlayMy.js";import{e as z,r as l}from"./vendor-DvMla3zT.js";import{I as G}from"./input-D-RABux3.js";import{T as J,a as X,b as g,c as p}from"./tabs-BUMRyipG.js";import{T as C,a as _,b as j,c as t,d as D,e as i}from"./table-73NXOjeZ.js";import{S as Q,a as W,b as Y,c as q,d as m}from"./select-B_3xXliF.js";import{e as k,a5 as L,i as B,Q as F}from"./ui-Bj_25f53.js";import"./maps-DK6RsE9k.js";import"./index-BdQq_4o_.js";import"./index-DuD6u1I3.js";function de(){const{profile:r,loading:u}=O(),v=z(),[n,U]=l.useState(null),[N,w]=l.useState([]),[R,A]=l.useState([]),[P,b]=l.useState(!0),[h,E]=l.useState("");l.useEffect(()=>{!u&&r?.role},[r,u,v]);const H=async()=>{const s=await fetch("/api/admin/stats");s.ok&&U(await s.json())},y=async()=>{let s="/api/admin/users";h&&(s+=`?search=${encodeURIComponent(h)}`);const a=await fetch(s);a.ok&&w(await a.json())},I=async()=>{const s=await fetch("/api/admin/config/badges");s.ok&&A(await s.json())};l.useEffect(()=>{r?.role==="admin"&&(b(!0),Promise.all([H(),y(),I()]).finally(()=>b(!1)))},[r]);const V=async(s,a)=>{try{(await fetch(`/api/admin/users/${s}/role`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:a})})).ok&&w(N.map(f=>f.id===s?{...f,role:a}:f))}catch(S){console.error(S)}};return l.useEffect(()=>{const s=setTimeout(()=>{r?.role==="admin"&&y()},500);return()=>clearTimeout(s)},[h]),u||P?e.jsx("div",{className:"flex h-[50vh] items-center justify-center",children:"Loading Admin Dashboard..."}):r?.role!=="admin"?e.jsxs("div",{className:"flex h-[50vh] flex-col items-center justify-center gap-4 text-center",children:[e.jsx(k,{className:"h-16 w-16 text-destructive/50"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You do not have permission to view this page."}),e.jsx(M,{onClick:()=>v("/"),children:"Go Home"})]}):e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage users, content, and platform configuration."})]})}),e.jsxs(J,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsxs(g,{value:"overview",children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Overview"]}),e.jsxs(g,{value:"users",children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Users"]}),e.jsxs(g,{value:"badges",children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Badges"]})]}),e.jsxs(p,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.total_users||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.active_now||0," active now"]})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Sightings"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.total_sightings||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reports submitted"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Missions"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.total_missions||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Community missions"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(c,{className:"col-span-4",children:[e.jsx(d,{children:e.jsx(o,{children:"Role Distribution"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(n?.users_by_role||{}).map(([s,a])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-32 capitalize font-medium",children:s}),e.jsx("div",{className:"flex-1 h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${a/(n?.total_users||1)*100}%`}})}),e.jsx("div",{className:"w-12 text-right text-sm text-muted-foreground",children:a})]},s))})})]}),e.jsxs(c,{className:"col-span-3",children:[e.jsxs(d,{children:[e.jsx(o,{children:"Recent Signups"}),e.jsx(T,{children:"New users in the platform."})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:n?.recent_signups.map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-muted flex items-center justify-center overflow-hidden",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"h-full w-full object-cover"}):e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s.username}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]},s.id))})})]})]})]}),e.jsxs(p,{value:"users",className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(G,{placeholder:"Search users...",className:"max-w-sm",value:h,onChange:s=>E(s.target.value)})}),e.jsx(c,{children:e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(j,{children:[e.jsx(t,{children:"User"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Level / XP"}),e.jsx(t,{children:"Joined"})]})}),e.jsx(D,{children:N.map(s=>e.jsxs(j,{children:[e.jsxs(i,{children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx(i,{children:e.jsxs(Q,{defaultValue:s.role,onValueChange:a=>V(s.id,a),children:[e.jsx(W,{className:"w-[140px] h-8",children:e.jsx(Y,{})}),e.jsxs(q,{children:[e.jsx(m,{value:"player",children:"Player"}),e.jsx(m,{value:"ambassador",children:"Ambassador"}),e.jsx(m,{value:"scientist",children:"Scientist"}),e.jsx(m,{value:"admin",children:"Admin"}),e.jsx(m,{value:"guest",children:"Guest"})]})]})}),e.jsxs(i,{children:["Lvl ",s.level," ",e.jsxs("span",{className:"text-muted-foreground",children:["(",s.xp," XP)"]})]}),e.jsx(i,{children:new Date(s.created_at).toLocaleDateString()})]},s.id))})]})})]}),e.jsx(p,{value:"badges",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Badges Configuration"}),e.jsx(T,{children:"View all configured badges."})]}),e.jsx(x,{children:e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Icon"}),e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Description"}),e.jsx(t,{children:"Category"}),e.jsx(t,{children:"Rarity"})]})}),e.jsx(D,{children:R.map(s=>e.jsxs(j,{children:[e.jsx(i,{className:"text-2xl",children:s.icon}),e.jsx(i,{className:"font-medium",children:s.name}),e.jsx(i,{className:"text-muted-foreground",children:s.description}),e.jsx(i,{children:e.jsx($,{variant:"outline",children:s.category})}),e.jsx(i,{className:"capitalize",children:s.rarity})]},s.id))})]})})]})})]})]})}function K({className:r}){return e.jsxs("svg",{className:r,fill:"none",height:"24",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}export{de as default};
