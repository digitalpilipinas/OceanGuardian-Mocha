import{w as R,v as D,j as e,P as T,y as U,S as O,K as q,s as J,u as K,k as W,C as w,a as k,b as C,f as N,c as S,g as X}from"./index-BYUs0uFb.js";import{r as o}from"./vendor-DvMla3zT.js";import{L as f}from"./label-ea3NOrYr.js";import{I as E}from"./input-qwEeOop4.js";import{u as Y}from"./index-DuD6u1I3.js";import{E as z,a3 as $}from"./ui-BFD__GsY.js";import"./maps-DK6RsE9k.js";var v="Switch",[G]=q(v),[Q,V]=G(v),M=o.forwardRef((s,u)=>{const{__scopeSwitch:r,name:c,checked:d,defaultChecked:a,required:i,disabled:l,value:p="on",onCheckedChange:t,form:n,...h}=s,[m,x]=o.useState(null),y=R(u,g=>x(g)),j=o.useRef(!1),P=m?n||!!m.closest("form"):!0,[b,H]=D({prop:d,defaultProp:a??!1,onChange:t,caller:v});return e.jsxs(Q,{scope:r,checked:b,disabled:l,children:[e.jsx(T.button,{type:"button",role:"switch","aria-checked":b,"aria-required":i,"data-state":L(b),"data-disabled":l?"":void 0,disabled:l,value:p,...h,ref:y,onClick:U(s.onClick,g=>{H(F=>!F),P&&(j.current=g.isPropagationStopped(),j.current||g.stopPropagation())})}),P&&e.jsx(I,{control:m,bubbles:!j.current,name:c,value:p,checked:b,required:i,disabled:l,form:n,style:{transform:"translateX(-100%)"}})]})});M.displayName=v;var A="SwitchThumb",B=o.forwardRef((s,u)=>{const{__scopeSwitch:r,...c}=s,d=V(A,r);return e.jsx(T.span,{"data-state":L(d.checked),"data-disabled":d.disabled?"":void 0,...c,ref:u})});B.displayName=A;var Z="SwitchBubbleInput",I=o.forwardRef(({__scopeSwitch:s,control:u,checked:r,bubbles:c=!0,...d},a)=>{const i=o.useRef(null),l=R(i,a),p=Y(r),t=O(u);return o.useEffect(()=>{const n=i.current;if(!n)return;const h=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(h,"checked").set;if(p!==r&&x){const y=new Event("click",{bubbles:c});x.call(n,r),n.dispatchEvent(y)}},[p,r,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...d,tabIndex:-1,ref:l,style:{...d.style,...t,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});I.displayName=Z;function L(s){return s?"checked":"unchecked"}var ee=M,ae=B;function _({className:s,size:u="default",...r}){return e.jsx(ee,{"data-slot":"switch","data-size":u,className:J("data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:aria-invalid:border-destructive/50 dark:data-[state=unchecked]:bg-input/80 shrink-0 rounded-full border border-transparent focus-visible:ring-[3px] aria-invalid:ring-[3px] data-[size=default]:h-[18.4px] data-[size=default]:w-[32px] data-[size=sm]:h-[14px] data-[size=sm]:w-[24px] peer group/switch relative inline-flex items-center transition-all outline-none after:absolute after:-inset-x-3 after:-inset-y-2 data-[disabled]:cursor-not-allowed data-[disabled]:opacity-50",s),...r,children:e.jsx(ae,{"data-slot":"switch-thumb",className:"bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground rounded-full group-data-[size=default]/switch:size-4 group-data-[size=sm]/switch:size-3 group-data-[size=default]/switch:data-[state=checked]:translate-x-[calc(100%-2px)] group-data-[size=sm]/switch:data-[state=checked]:translate-x-[calc(100%-2px)] group-data-[size=default]/switch:data-[state=unchecked]:translate-x-0 group-data-[size=sm]/switch:data-[state=unchecked]:translate-x-0 pointer-events-none block ring-0 transition-transform"})})}function de(){const{profile:s}=K(),[u,r]=o.useState(!0),[c,d]=o.useState(!1),[a,i]=o.useState({region:"",country:"",leaderboard_visible:!0,is_anonymous:!1,notifications_enabled:!0});o.useEffect(()=>{if(!s)return;(async()=>{try{const n=await fetch("/api/profiles/me");if(n.ok){const h=await n.json();i({region:h.region||"",country:h.country||"",leaderboard_visible:h.leaderboard_visible===1,is_anonymous:h.is_anonymous===1,notifications_enabled:h.notifications_enabled===1})}}catch(n){console.error("Failed to load settings:",n)}finally{r(!1)}})()},[s]);const{toast:l}=W(),p=async()=>{if(s){d(!0);try{const t={region:a.region,country:a.country,leaderboard_visible:a.leaderboard_visible?1:0,is_anonymous:a.is_anonymous?1:0,notifications_enabled:a.notifications_enabled?1:0};(await fetch("/api/profiles/me",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?l({title:"Settings saved",description:"Your preferences have been updated."}):l({title:"Error",description:"Failed to save settings.",variant:"destructive"})}catch(t){console.error("Error saving settings:",t),l({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{d(!1)}}};return u?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Settings"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(C,{children:"Location"}),e.jsx(N,{children:"Set your location to join regional leaderboards."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"country",children:"Country"}),e.jsx(E,{id:"country",value:a.country,onChange:t=>i({...a,country:t.target.value}),placeholder:"e.g. Philippines"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"region",children:"Region / City"}),e.jsx(E,{id:"region",value:a.region,onChange:t=>i({...a,region:t.target.value}),placeholder:"e.g. Manila"})]})]})]}),e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(C,{children:"Privacy"}),e.jsx(N,{children:"Manage how you appear to others."})]}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Show in Leaderboards"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow your profile to appear on public leaderboards."})]}),e.jsx(_,{checked:a.leaderboard_visible,onCheckedChange:t=>i({...a,leaderboard_visible:t})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Anonymous Mode"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Hide your name and avatar on leaderboards (you will appear as "Anonymous").'})]}),e.jsx(_,{checked:a.is_anonymous,onCheckedChange:t=>i({...a,is_anonymous:t})})]})]})]}),e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(C,{children:"Notifications"}),e.jsx(N,{children:"Manage your notification preferences."})]}),e.jsx(S,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Enable Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive alerts about mission updates and rewards."})]}),e.jsx(_,{checked:a.notifications_enabled,onCheckedChange:t=>i({...a,notifications_enabled:t})})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(X,{onClick:p,disabled:c,className:"w-full sm:w-auto",children:[c&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),!c&&e.jsx($,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})]})}export{de as default};
