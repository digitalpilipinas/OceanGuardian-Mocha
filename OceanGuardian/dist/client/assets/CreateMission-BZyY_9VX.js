import{u as w,k as F,j as e,g as v,C as M,a as T,b as D,f as I,c as E}from"./index-vnCiXHxm.js";import{e as L,r as c}from"./vendor-DvMla3zT.js";import{I as i}from"./input-tiSa_AdS.js";import{L as t}from"./label-BBeaRLPN.js";import{T as B}from"./textarea-Cz5lOxLG.js";import{S as O,a as q,b as A,c as k,d as o}from"./select-Bi8fzCKi.js";import{E as N,N as z,l as P,C as y,i as U,O as H}from"./ui-BhhnkDhR.js";import"./maps-DK6RsE9k.js";import"./index-BdQq_4o_.js";import"./index-DuD6u1I3.js";function $(){const{profile:d}=w(),m=L(),{toast:u}=F(),[p,x]=c.useState(!0),[g,j]=c.useState(!1),[C,_]=c.useState(!1),[s,f]=c.useState({title:"",description:"",location_name:"",latitude:"",longitude:"",start_time:"",end_time:"",difficulty:"1",max_participants:"",image_url:""});c.useEffect(()=>{d?(["admin","ambassador"].includes(d.role)?_(!0):(u({title:"Access Denied",description:"Only Ambassadors and Admins can create missions.",variant:"destructive"}),m("/missions")),x(!1)):!d&&!p&&x(!1)},[d,m,u,p]);const a=r=>{const{name:l,value:n}=r.target;f(h=>({...h,[l]:n}))},b=(r,l)=>{f(n=>({...n,[r]:l}))},S=async r=>{r.preventDefault(),j(!0);try{const l={...s,latitude:parseFloat(s.latitude),longitude:parseFloat(s.longitude),difficulty:parseInt(s.difficulty),max_participants:s.max_participants?parseInt(s.max_participants):void 0,start_time:new Date(s.start_time).toISOString(),end_time:new Date(s.end_time).toISOString()},n=await fetch("/api/missions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!n.ok){const h=await n.json();throw new Error(h.error||"Failed to create mission")}u({title:"Mission Created!",description:"Your cleanup mission has been successfully published."}),m("/missions")}catch(l){u({title:"Error",description:l.message,variant:"destructive"})}finally{j(!1)}};return p?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):C?e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 md:pb-8 max-w-2xl",children:[e.jsxs(v,{variant:"ghost",onClick:()=>m("/missions"),className:"mb-4 pl-0",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back to Missions"]}),e.jsxs(M,{children:[e.jsxs(T,{children:[e.jsx(D,{className:"text-2xl",children:"Create Cleanup Mission"}),e.jsx(I,{children:"Organize a community cleanup event. Fill in the details below."})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"title",children:"Mission Title"}),e.jsx(i,{id:"title",name:"title",placeholder:"e.g., Beach Cleanup at Blue Bay",required:!0,value:s.title,onChange:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"description",children:"Description"}),e.jsx(B,{id:"description",name:"description",placeholder:"Describe the mission goals, what to bring, meeting point, etc.",required:!0,value:s.description,onChange:a,rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"location_name",children:"Location Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(i,{id:"location_name",name:"location_name",placeholder:"e.g. Blue Bay Beach",required:!0,value:s.location_name,onChange:a,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Coordinates"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{name:"latitude",placeholder:"Lat (e.g. 14.5)",required:!0,type:"number",step:"any",value:s.latitude,onChange:a}),e.jsx(i,{name:"longitude",placeholder:"Long (e.g. 120.9)",required:!0,type:"number",step:"any",value:s.longitude,onChange:a})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: Use the Map page to find coordinates."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"start_time",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx(i,{id:"start_time",name:"start_time",type:"datetime-local",required:!0,value:s.start_time,onChange:a,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"end_time",children:"End Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx(i,{id:"end_time",name:"end_time",type:"datetime-local",required:!0,value:s.end_time,onChange:a,className:"pl-9"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"difficulty",children:"Difficulty (1-5)"}),e.jsxs(O,{value:s.difficulty,onValueChange:r=>b("difficulty",r),children:[e.jsx(q,{children:e.jsx(A,{placeholder:"Select"})}),e.jsxs(k,{children:[e.jsx(o,{value:"1",children:"1 - Easy"}),e.jsx(o,{value:"2",children:"2 - Moderate"}),e.jsx(o,{value:"3",children:"3 - Challenging"}),e.jsx(o,{value:"4",children:"4 - Hard"}),e.jsx(o,{value:"5",children:"5 - Extreme"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"max_participants",children:"Max Participants"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(i,{id:"max_participants",name:"max_participants",type:"number",placeholder:"e.g. 20",value:s.max_participants,onChange:a,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"image_url",children:"Image URL (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(i,{id:"image_url",name:"image_url",placeholder:"https://...",value:s.image_url,onChange:a,className:"pl-9"})]})]})]}),e.jsx(v,{type:"submit",className:"w-full",size:"lg",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Mission..."]}):"Create Mission"})]})})]})]}):null}export{$ as default};
