import{u as S,k as F,j as e,g as j,C as M,a as T,b as D,f as I,c as E}from"./index-CLnlayMy.js";import{e as L,r as c}from"./vendor-DvMla3zT.js";import{I as l}from"./input-D-RABux3.js";import{L as r}from"./label-C1irR0zl.js";import{T as B}from"./textarea-CWxFdNV4.js";import{S as O,a as k,b as q,c as A,d as o}from"./select-B_3xXliF.js";import{E as f,N as z,l as P,C as v,i as U,O as H}from"./ui-Bj_25f53.js";import"./maps-DK6RsE9k.js";import"./index-BdQq_4o_.js";import"./index-DuD6u1I3.js";function $(){const{user:p}=S(),d=L(),{toast:m}=F(),[y,N]=c.useState(!0),[h,x]=c.useState(!1),[C,_]=c.useState(!1),[s,g]=c.useState({title:"",description:"",location_name:"",latitude:"",longitude:"",start_time:"",end_time:"",difficulty:"1",max_participants:"",image_url:""});c.useEffect(()=>{async function i(){if(p)try{const a=await fetch("/api/profiles/me");if(a.ok){const n=await a.json();["admin","ambassador"].includes(n.role)?_(!0):(m({title:"Access Denied",description:"Only Ambassadors and Admins can create missions.",variant:"destructive"}),d("/missions"))}}catch(a){console.error("Failed to check permissions",a)}finally{N(!1)}}i()},[p,d,m]);const t=i=>{const{name:a,value:n}=i.target;g(u=>({...u,[a]:n}))},b=(i,a)=>{g(n=>({...n,[i]:a}))},w=async i=>{i.preventDefault(),x(!0);try{const a={...s,latitude:parseFloat(s.latitude),longitude:parseFloat(s.longitude),difficulty:parseInt(s.difficulty),max_participants:s.max_participants?parseInt(s.max_participants):void 0,start_time:new Date(s.start_time).toISOString(),end_time:new Date(s.end_time).toISOString()},n=await fetch("/api/missions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const u=await n.json();throw new Error(u.error||"Failed to create mission")}m({title:"Mission Created!",description:"Your cleanup mission has been successfully published."}),d("/missions")}catch(a){m({title:"Error",description:a.message,variant:"destructive"})}finally{x(!1)}};return y?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):C?e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 md:pb-8 max-w-2xl",children:[e.jsxs(j,{variant:"ghost",onClick:()=>d("/missions"),className:"mb-4 pl-0",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back to Missions"]}),e.jsxs(M,{children:[e.jsxs(T,{children:[e.jsx(D,{className:"text-2xl",children:"Create Cleanup Mission"}),e.jsx(I,{children:"Organize a community cleanup event. Fill in the details below."})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"title",children:"Mission Title"}),e.jsx(l,{id:"title",name:"title",placeholder:"e.g., Beach Cleanup at Blue Bay",required:!0,value:s.title,onChange:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"description",children:"Description"}),e.jsx(B,{id:"description",name:"description",placeholder:"Describe the mission goals, what to bring, meeting point, etc.",required:!0,value:s.description,onChange:t,rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"location_name",children:"Location Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(l,{id:"location_name",name:"location_name",placeholder:"e.g. Blue Bay Beach",required:!0,value:s.location_name,onChange:t,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Coordinates"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{name:"latitude",placeholder:"Lat (e.g. 14.5)",required:!0,type:"number",step:"any",value:s.latitude,onChange:t}),e.jsx(l,{name:"longitude",placeholder:"Long (e.g. 120.9)",required:!0,type:"number",step:"any",value:s.longitude,onChange:t})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: Use the Map page to find coordinates."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"start_time",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx(l,{id:"start_time",name:"start_time",type:"datetime-local",required:!0,value:s.start_time,onChange:t,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"end_time",children:"End Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx(l,{id:"end_time",name:"end_time",type:"datetime-local",required:!0,value:s.end_time,onChange:t,className:"pl-9"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"difficulty",children:"Difficulty (1-5)"}),e.jsxs(O,{value:s.difficulty,onValueChange:i=>b("difficulty",i),children:[e.jsx(k,{children:e.jsx(q,{placeholder:"Select"})}),e.jsxs(A,{children:[e.jsx(o,{value:"1",children:"1 - Easy"}),e.jsx(o,{value:"2",children:"2 - Moderate"}),e.jsx(o,{value:"3",children:"3 - Challenging"}),e.jsx(o,{value:"4",children:"4 - Hard"}),e.jsx(o,{value:"5",children:"5 - Extreme"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"max_participants",children:"Max Participants"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(l,{id:"max_participants",name:"max_participants",type:"number",placeholder:"e.g. 20",value:s.max_participants,onChange:t,className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"image_url",children:"Image URL (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(l,{id:"image_url",name:"image_url",placeholder:"https://...",value:s.image_url,onChange:t,className:"pl-9"})]})]})]}),e.jsx(j,{type:"submit",className:"w-full",size:"lg",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Mission..."]}):"Create Mission"})]})})]})]}):null}export{$ as default};
